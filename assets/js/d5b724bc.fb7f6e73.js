"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[656],{224:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/mipi_csi2-82ebb98cd32df46b6d739e9c8a6fd69e.png"},6629:e=>{e.exports=JSON.parse('{"DU":"Sentinel","_E":"SOM_SL1680_Mk1","tH":"CMSAC1_AS6806_A","mQ":"sentinel_som_sl1680_mk1","zn":"EVK_SL1680_Mk1","sV":"CMCGAS_AGSL_A","UW":"sentinel-core","ND":"sentinel-media","Uf":"sentinel-media-oobe","IM":"meta-dctk-sentinel","Cy":"root","PO":"setinel"}')},7189:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"hardware-docs/mipi_csi","title":"MIPI CSI","description":"Let\'s verify MIPI CSI.","source":"@site/docs/hardware-docs/mipi_csi.mdx","sourceDirName":"hardware-docs","slug":"/hardware-docs/mipi_csi","permalink":"/test/docs/hardware-docs/mipi_csi","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"HDMI TX","permalink":"/test/docs/hardware-docs/hdmi_tx"},"next":{"title":"MIPI DSI","permalink":"/test/docs/hardware-docs/mipi_dsi"}}');var i=s(4848),r=s(8453),a=s(6629);s(6540);const o={sidebar_position:4},d="MIPI CSI",l={},c=[{value:"Getting Started",id:"getting-started",level:2},{value:"Image Sensor Cameras",id:"image-sensor-cameras",level:2},{value:"Multi Stream Support",id:"multi-stream-support",level:2},{value:"Dual Sensor Support",id:"dual-sensor-support",level:2},{value:"Updating the ISP Sensor Configuration",id:"updating-the-isp-sensor-configuration",level:2},{value:"Steps to verify the CSI interface using OV5647",id:"steps-to-verify-the-csi-interface-using-ov5647",level:2},{value:"Overlays to by used",id:"overlays-to-by-used",level:3},{value:"1. Updating Device Tree Overlay",id:"1-updating-device-tree-overlay",level:3},{value:"2. Changing the Camera Sensor Module",id:"2-changing-the-camera-sensor-module",level:3},{value:"1. Read the current sensor configuration.",id:"1-read-the-current-sensor-configuration",level:4},{value:"2. Configuring the new module",id:"2-configuring-the-new-module",level:4},{value:"3. Getting the camera stream",id:"3-getting-the-camera-stream",level:4}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mipi-csi",children:"MIPI CSI"})}),"\n",(0,i.jsxs)(n.p,{children:["Let's verify ",(0,i.jsx)(n.strong,{children:"MIPI CSI"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsxs)(n.p,{children:[a.DU," ",a._E," support 2 MIPI CSI ports, CSI0 and CSI1."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSI0 - 4 lane - 22 pin"}),"\n",(0,i.jsx)(n.li,{children:"CSI1 - 2 lane - 15 pin"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"image-sensor-cameras",children:"Image Sensor Cameras"}),"\n",(0,i.jsxs)(n.p,{children:[a.DU," ",a._E," includes an integrated ISP and supports connecting image sensor camera modules using the MIPI-CSI connectors. Gstreamer can use these cameras using the V4L2 interface. The ISP supports 3 output paths, the main path supports outputing 4K resolution (if the sensor supports 4K), and the Secondary Paths support 2K resolution. Each path has it\u2019s own video device file in /dev."]}),"\n",(0,i.jsxs)(n.p,{children:["The device file number may vary depending on your configuration. You can use the ",(0,i.jsx)(n.code,{children:"v4l2-ctl"})," command to find which device files are associated with each of the ISP paths."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"v4l2-ctl --list-device\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Alt mipi_csi1",src:s(8555).A+"",width:"10400",height:"6900"})}),"\n",(0,i.jsx)(n.p,{children:"An additional video device is created to support Bayer RGB capture. This is the 4th video instance which advertises itself as only supporting Bayer RGB. The other 3 video ports support NV12 / RGB only."}),"\n",(0,i.jsx)(n.p,{children:"To display video from the ISP\u2019s Main Path:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"gst-launch-1.0 v4l2src device=/dev/video3 ! 'video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1' ! waylandsink\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To display video from the ISP\u2019s Secondary Paths change the ",(0,i.jsx)(n.code,{children:"device"})," in the command accordingly."]}),"\n",(0,i.jsx)(n.h2,{id:"multi-stream-support",children:"Multi Stream Support"}),"\n",(0,i.jsxs)(n.p,{children:[a.DU," ",a._E," supports up to three video streams to be enabled simultaneously (excluding the Bayer RGB video port - vvcam-video.0.3). Up to three different GStreamer pipelines can be run at the same time to validate this feature any combination of up to 3 paths \u2014 Main, Secondary Path 1, and Secondary Path 2 can be run simultaneously."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Although multiple streams may appear as independent devices, all streams originate from a single instance. Once all streams are playing, any change made to an existing stream is treated as a new change. Hence, ensure that all sessions are closed one by one before starting the next set of multi or single streaming."})}),"\n",(0,i.jsx)(n.h2,{id:"dual-sensor-support",children:"Dual Sensor Support"}),"\n",(0,i.jsxs)(n.p,{children:[a.DU," ",a._E," supports dual sensor configuration with the OV5647 sensor module. Dual sensor support required enabling the ",a.DU,"-bothcsi-without-expander.dtbo overlay. (See ",(0,i.jsx)(n.a,{href:"https://synaptics-astra.github.io/doc/v/1.6.0/subject/updating_isp_sensor_configuration.html",children:"Updating the ISP Sensor Configuration"}),"). Once the two sensors are connected and the overlay is enabled, v4l2-ctl will display a total of eight vvcam-video devices- three NV12 / RGB devices plus one Bayer RGB device per sensor."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Alt mipi_csi2",src:s(224).A+"",width:"8860",height:"10400"})}),"\n",(0,i.jsx)(n.p,{children:"Similar to multi stream support, multiple Gstreamer pipelines can be used with both sensors simultaniously."}),"\n",(0,i.jsx)(n.p,{children:"For example, these commands will display video from the main path of the sensor connected to CSI0 and video from the main path of the sensor connected to CSI1."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"gst-launch-1.0 v4l2src device=/dev/video3 ! 'video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)30/1' ! waylandsink\n\ngst-launch-1.0 v4l2src device=/dev/video7 ! 'video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)30/1' ! waylandsink\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["IMX258 and IMX415 sensors are not supported with the dual sensor configuration on ",a.DU," ",a._E," boards. Both sensors require a GPIO expander whereas CSI1 is incompatible with the GPIO expander."]})}),"\n",(0,i.jsx)(n.h2,{id:"updating-the-isp-sensor-configuration",children:"Updating the ISP Sensor Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["By default, ",a.DU," ",a._E," is configured to use the OV5647 module with port CSI0. But, the software can be configured to use any of the supported sensor modules. Some configurations require setting a device tree overlay to function correctly. We verified both the CSI0 and CSI1 using OV5647 interface."]}),"\n",(0,i.jsx)(n.h2,{id:"steps-to-verify-the-csi-interface-using-ov5647",children:"Steps to verify the CSI interface using OV5647"}),"\n",(0,i.jsx)(n.h3,{id:"overlays-to-by-used",children:"Overlays to by used"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Sensor"}),(0,i.jsx)(n.th,{children:"Module"}),(0,i.jsx)(n.th,{children:"Interface"}),(0,i.jsx)(n.th,{children:"Device Tree Overlay"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OV5647"}),(0,i.jsx)(n.td,{children:"Arducam 5MP OV5647 Camera Module"}),(0,i.jsxs)(n.td,{children:["MIPI-CSI 0",(0,i.jsx)("br",{})," MIPI-CSI 1",(0,i.jsx)("br",{})," Dual CSI0/1"]}),(0,i.jsxs)(n.td,{children:["N/A ",(0,i.jsx)("br",{})," sentinel-sl1680-csi1-without-expander.dtbo ",(0,i.jsx)("br",{})," sentinel-sl1680-bothcsi-without-expander.dtbo"]})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"1-updating-device-tree-overlay",children:"1. Updating Device Tree Overlay"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Boot into U-Boot by continuosly pressing any key while booting and set variable ",(0,i.jsx)(n.code,{children:"dtbo"})," with the required device tree overlay."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For example to use the OV5647 camera module in CSI1 port:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"setenv dtbo sentinel-sl1680-csi1-without-expander.dtbo\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify the variable is correctly set in the U-Boot."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"printenv\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Save the variable to the eMMC for persist in reboot."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"saveenv\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Finally boot the device with updated overlay."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"boot\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-changing-the-camera-sensor-module",children:"2. Changing the Camera Sensor Module"}),"\n",(0,i.jsxs)(n.p,{children:["The file ",(0,i.jsx)(n.code,{children:"/proc/vsi/isp_subdev0"})," is used to display the sensor configuration properties and to update the sensor configuration."]}),"\n",(0,i.jsx)(n.h4,{id:"1-read-the-current-sensor-configuration",children:"1. Read the current sensor configuration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat /proc/vsi/isp_subdev0\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-configuring-the-new-module",children:"2. Configuring the new module"}),"\n",(0,i.jsxs)(n.p,{children:["Configuring the new module by editing ",(0,i.jsx)(n.code,{children:"/usr/sbin/isp_media_server.sh"})," script. Change the line which writes the sensor config to /proc/vsi/isp_subdev0. Update the sensor name, xml, and json files for the new sensor."]}),"\n",(0,i.jsx)(n.p,{children:"To list the available xml and json files for sensor please use:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ls /usr/share\n"})}),"\n",(0,i.jsx)(n.p,{children:"For example to use the OV5647 camera module in CSI1 port:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Alt mipi_csi2",src:s(224).A+"",width:"8860",height:"10400"})}),"\n",(0,i.jsx)(n.p,{children:"Then restart the isp_media_server service to apply the update."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl restart isp_media_server\n"})}),"\n",(0,i.jsx)(n.h4,{id:"3-getting-the-camera-stream",children:"3. Getting the camera stream"}),"\n",(0,i.jsx)(n.p,{children:"We can use the Gstreamer utility for getting the video stream from the camera module."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"gst-launch-1.0 v4l2src device=/dev/video3 ! 'video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)30/1' ! waylandsink\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Please follow the steps to described above to identify the /dev/video device corresponding to the camera module."})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},8555:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/mipi_csi1-bfa4844137004d7f7e252427234890ff.png"}}]);